<template>
    <!-- ğŸ‘‡ æ–°å¢é¢„è§ˆåŒºåŸŸ -->
    <div class="file-preview" v-if="previewContent || previewPdfUrl">
      <div class="preview-title">{{ $t("preview.title") }}</div>
      <!-- æ–‡æœ¬é¢„è§ˆ -->
      <pre v-if="previewContent" class="code-preview">{{ previewContent }}</pre>
      <!-- PDF é¢„è§ˆ -->
      <iframe
        v-else-if="previewPdfUrl"
        :src="previewPdfUrl"
        class="pdf-preview"
        frameborder="0"
      ></iframe>
    </div>
</template>

<script setup lang="ts">
import { provide, ref } from 'vue';

// é¢„è§ˆæ–‡ä»¶å†…å®¹

// ====== æ–°å¢ï¼šé¢„è§ˆç›¸å…³é€»è¾‘ ======
const previewContent = ref<string | null>(null);
const previewPdfUrl = ref<string | null>(null);

// const previewFile = async (filePath: string) => {
//   const file = fileMap.value[filePath];
//   if (!file) return;

//   if (file.size > 2 * 1024 * 1024) {
//     previewContent.value = "âš ï¸ æ–‡ä»¶è¿‡å¤§ï¼Œä¸æ”¯æŒé¢„è§ˆ";
//     return;
//   }

//   // æ¸…ç†ä¸Šä¸€ä¸ª PDF URLï¼ˆé˜²æ­¢å†…å­˜æ³„æ¼ï¼‰
//   if (previewPdfUrl.value) {
//     URL.revokeObjectURL(previewPdfUrl.value);
//     previewPdfUrl.value = null;
//   }
//   previewContent.value = null;

//   const ext = filePath.split(".").pop()?.toLowerCase();

//   // PDF é¢„è§ˆ
//   if (ext === "pdf") {
//     previewPdfUrl.value = URL.createObjectURL(file);
//     return;
//   }

//   // æ”¯æŒçš„æ–‡æœ¬ç±»å‹
//   const textExtensions = [
//     "txt",
//     "vue",
//     "jsx",
//     "js",
//     "ts",
//     "tsx",
//     "xml",
//     "json",
//     "html",
//     "htm",
//     "css",
//     "scss",
//     "md",
//     "yaml",
//     "yml",
//     "ini",
//     "log",
//   ];

//   if (ext && textExtensions.includes(ext)) {
//     try {
//       const content = await file.text();
//       previewContent.value = content;
//     } catch (err) {
//       previewContent.value = "âŒ æ— æ³•è¯»å–æ–‡ä»¶å†…å®¹";
//     }
//     return;
//   }

//   // ä¸æ”¯æŒçš„ç±»å‹
//   previewContent.value = "âš ï¸ ä¸æ”¯æŒé¢„è§ˆæ­¤ç±»å‹æ–‡ä»¶";
// };

// æä¾›ç»™å­ç»„ä»¶
// provide("previewFile", previewFile);
</script>

<style scoped>

</style>